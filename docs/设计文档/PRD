这是一个非常明智的决定。直接把这份**结构化、技术导向的 PRD** 投喂给 AI IDE（如 Cursor, Windsurf, GitHub Copilot Workspace），它能立刻理解你的数据库结构、业务逻辑和API规范，从而生成高质量的代码。

这份文档我是专门为了**“写给 AI 看”**而优化的，去掉了废话，强调了数据结构和逻辑约束。

---

# 项目需求文档 (PRD) - 积分活动运营平台

**版本**: V1.0
**适用对象**: AI 辅助开发工具 (AI IDE) / 全栈开发者

## 1. 项目概况 (Project Overview)

开发一个支持 **PC Web** 和 **微信小程序** 双端的积分活动运营平台。
核心闭环：用户注册/登录 -> 参与活动（动态表单） -> 系统/人工审核 -> 发放积分 -> 商城兑换商品。

## 2. 技术栈规范 (Tech Stack)

* **前端 (用户端)**: Uni-app (基于 Vue3) - 用于构建 H5 和 微信小程序。
* **前端 (管理后台)**: Vue3 + Element Plus + Vite。
* **后端**: Python (Django/FastAPI) 或 Node.js (NestJS) —— *[请根据实际偏好选择]*。
* **数据库**: MySQL 5.7+ (存储核心业务数据)。
* **缓存**: Redis (用于验证码、频率限制、活动热数据)。
* **存储**: 对象存储 (AWS S3 / 阿里云 OSS) 用于存储用户上传的图片/附件。

---

## 3. 数据库设计 (Database Schema)

**指令给 AI**: 请基于以下 Schema 设计生成数据库模型 (Models) 和建表语句。

### 3.1 用户表 (`users`)

* `id`: BigInt, PK
* `phone`: Varchar, Unique, Index (手机号)
* `points_balance`: Int, Default 0 (当前积分)
* `fingerprint_hash`: Varchar (设备指纹哈希，用于风控)
* `referrer_id`: BigInt, Nullable (推荐人ID)
* `invite_code`: Varchar (专属邀请码)
* `is_active`: Boolean
* `created_at`: Datetime

### 3.2 活动配置表 (`activities`)

* `id`: BigInt, PK
* `title`: Varchar (活动名称)
* `description`: Text (活动规则描述)
* `status`: Enum('draft', 'active', 'ended')
* `audit_type`: Enum('auto', 'manual') (自动审核 / 人工审核)
* `frequency_type`: Enum('once', 'daily', 'unlimited') (频次限制：终身一次/每日一次/不限)
* `max_participations`: Int (配合频次类型使用，例如每日3次)
* `form_schema`: JSON (关键字段)
* *描述*: 存储动态表单的定义。
* *示例*: `[{"key": "order_no", "type": "text", "required": true}, {"key": "pic", "type": "image"}]`


* `reward_points`: Int (固定积分值，若需人工手动输入则设为0)

### 3.3 提交记录表 (`activity_submissions`)

* `id`: BigInt, PK
* `user_id`: FK -> users.id
* `activity_id`: FK -> activities.id
* `submission_data`: JSON (关键字段)
* *描述*: 存储用户提交的具体数据。
* *示例*: `{"order_no": "123456", "pic": "https://oss.../img.jpg"}`


* `status`: Enum('pending', 'approved', 'rejected')
* `granted_points`: Int (实际发放的积分)
* `audit_remark`: Varchar (审核备注/拒绝理由)
* `auditor_id`: BigInt (操作管理员ID)
* `created_at`: Datetime

### 3.4 商品表 (`products`)

* `id`: BigInt, PK
* `name`: Varchar
* `type`: Enum('virtual', 'physical') (虚拟/实物)
* `price_points`: Int (所需积分)
* `stock`: Int (库存)
* `image_url`: Varchar

### 3.5 订单表 (`orders`)

* `id`: BigInt, PK
* `user_id`: FK
* `product_id`: FK
* `status`: Enum('pending', 'shipped', 'completed')
* `delivery_info`: JSON (存收货地址 或 发货的物流单号/卡密)

---

## 4. 核心业务逻辑 (Business Logic)

### 4.1 安全与注册 (Security & Auth)

1. **指纹风控**: 前端采集设备指纹，后端比对。如果判定为高风险 IP/设备，强制弹出图形验证码 (Captcha)。
2. **验证通过**: 验证码通过后，才允许发送短信验证码或进行登录检查。

### 4.2 活动参与逻辑 (Activity Participation)

**API**: `POST /api/activities/{id}/submit`
**逻辑流**:

1. **检查资格**: 查询 `activity_submissions` 表。
* 若 `frequency_type` == 'once' 且已存在记录 -> 报错“仅限参与一次”。
* 若 `frequency_type` == 'daily' 且今日记录 >= `max_participations` -> 报错“今日次数已满”。


2. **校验表单**: 读取 `activities.form_schema`，校验用户提交的 `submission_data` 是否包含所有 `required` 字段。
3. **创建记录**: 插入数据，状态默认为 `pending`。
4. **自动审核判定**:
* 若 `activities.audit_type` == 'auto' -> 立即执行自动规则(如查重) -> 更新状态 `approved` -> 触发积分发放。



### 4.3 审核与发分 (Audit Workflow)

**API**: `POST /api/admin/submissions/{id}/audit`
**逻辑流**:

1. 管理员提交 `{ status: 'approved', points: 100 }`。
2. **事务处理**:
* 更新 `activity_submissions` 状态和 `granted_points`。
* 更新 `users.points_balance` (增加积分)。
* 写入 `points_log` (积分流水表，建议补充此表)。



### 4.4 商城兑换 (Redemption)

1. **扣减库存**: 检查 `products.stock`。
2. **扣减积分**: 检查 `users.points_balance`。
3. **交付分流**:
* `type` == 'virtual': 生成邮件发送任务或自动发卡密。
* `type` == 'physical': 生成待发货订单，等待管理员录入物流单号。



---

## 5. API 接口清单 (API Endpoints)

**指令给 AI**: 请生成遵循 RESTful 风格的 API 路由。

### 用户端

* `POST /auth/login`: 手机号登录/注册
* `GET /activities`: 活动列表 (支持状态过滤)
* `GET /activities/{id}`: 活动详情 (包含 form_schema)
* `POST /activities/{id}/submit`: 提交活动
* `GET /mall/products`: 商品列表
* `POST /mall/redeem`: 积分兑换
* `GET /user/profile`: 个人信息 (含积分、邀请码)
* `GET /user/records`: 积分与兑换记录

### 管理端

* `POST /admin/activities`: 创建/编辑活动 (配置表单 JSON)
* `GET /admin/submissions`: 审核列表 (分页, 筛选)
* `POST /admin/submissions/{id}/audit`: 审核操作 (通过/拒绝/给分)
* `POST /admin/orders/{id}/deliver`: 订单发货

---

## 6. 前端交互细节 (Frontend UI/UX)

1. **动态表单渲染**:
* 前端需编写一个通用组件 `DynamicForm`，接收 `form_schema` JSON 数组，循环渲染 `Input`, `Upload`, `Textarea` 等组件。


2. **状态展示**:
* 活动卡片需根据用户参与状态显示：`立即参与` (高亮) / `审核中` (置灰) / `已完成` (置灰)。


3. **附件预览**:
* 管理后台审核页，点击图片附件需支持大图预览 (Lightbox模式)，支持 PDF 浏览器内嵌预览。



---

### 如何使用这份 PRD？

**建议的 Prompt（提示词）：**

> “你是一个全栈高级工程师。我正在开发一个积分活动平台。请阅读以下 PRD 文档，并严格按照其中的数据库 Schema 和业务逻辑，为我生成 **[后端 Models 代码 / 核心 API 逻辑 / 前端动态表单组件]**。”
> *(然后粘贴上面的内容)*