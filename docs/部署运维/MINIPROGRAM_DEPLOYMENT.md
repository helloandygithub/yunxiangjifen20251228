# 微信小程序部署指南

**更新时间：** 2025-12-31

---

## ✅ 小程序信息

| 配置项 | 值 |
|--------|-----|
| **AppID** | wxc70517967d5d057d |
| **AppSecret** | 6f7b53c565e4fbbc4303716f60eca878 |
| **后端域名** | https://cloudexp.top |

---

## 📋 部署前准备

### 1. 配置服务器域名（必须先完成）

访问：https://mp.weixin.qq.com/

**路径：** 开发 → 开发管理 → 开发设置 → 服务器域名

**需要配置的域名：**

```
request合法域名：
https://cloudexp.top

uploadFile合法域名：
https://cloudexp.top

downloadFile合法域名：
https://cloudexp.top
```

**⚠️ 重要提醒：**
- 必须是 **HTTPS**（需要先在服务器上配置SSL证书）
- 域名必须已备案（✅ 已完成）
- 每月只能修改5次，请确认无误后再提交

---

## 🔧 代码配置

### 步骤1：更新API地址

修改 `webapp/src/utils/request.js`：

```javascript
// 找到 BASE_URL 配置
const BASE_URL = 'https://cloudexp.top/api'  // 生产环境

// 或使用条件判断
const BASE_URL = process.env.NODE_ENV === 'production'
  ? 'https://cloudexp.top/api'
  : 'http://localhost:8000/api'
```

### 步骤2：更新小程序配置

修改 `webapp/manifest.json`，确认AppID：

```json
{
  "mp-weixin": {
    "appid": "wxc70517967d5d057d",
    ...
  }
}
```

---

## 🏗️ 构建和上传

### 1. 构建小程序

```bash
cd /Users/kongkevin/云享积分20251228/webapp
npm run build:mp-weixin
```

构建产物位置：`dist/build/mp-weixin`

### 2. 使用微信开发者工具上传

1. **打开微信开发者工具**
2. **导入项目**
   - 项目目录：`/Users/kongkevin/云享积分20251228/webapp/dist/build/mp-weixin`
   - AppID：wxc70517967d5d057d
   - 项目名称：云享积分平台

3. **测试功能**
   - 确保所有功能正常
   - 测试API连接
   - 测试图片上传
   - 测试短信验证码

4. **上传代码**
   - 点击右上角"上传"按钮
   - 版本号：`1.0.0`
   - 项目备注：`云享积分平台正式版本`

---

## 📝 提交审核

### 1. 登录微信公众平台

访问：https://mp.weixin.qq.com/

### 2. 配置类目和资质

**路径：** 设置 → 基本设置 → 服务类目

**建议类目：**
- 商家自营 → 百货（需要营业执照）
- 工具 → 信息查询
- 商业服务 → 其他

### 3. 配置隐私设置

**路径：** 设置 → 基本设置 → 隐私设置

**需要声明的权限：**
- 用户信息（昵称、头像）
- 位置信息（如果使用）
- 相册（图片上传）
- 摄像头（拍照上传）

**隐私政策URL：** https://cloudexp.top/privacy.html

### 4. 提交审核

**路径：** 版本管理 → 开发版本 → 提交审核

**填写信息：**

| 字段 | 内容 |
|------|------|
| **版本号** | 1.0.0 |
| **版本描述** | 云享积分平台正式版本，包含活动参与、积分商城、个人中心等核心功能 |
| **测试账号** | 提供测试用的手机号和验证码 |

**功能页面说明：**
- 首页：展示用户积分、快捷入口、热门活动
- 活动大厅：浏览和参与各类积分活动
- 积分商城：使用积分兑换商品
- 我的：个人中心，查看积分、订单等

---

## ⏱️ 审核时间

- **正常审核**：1-3个工作日
- **加急审核**：需要特殊申请
- **审核失败**：根据反馈修改后重新提交

---

## 🚀 发布上线

### 审核通过后

1. 登录微信公众平台
2. 版本管理 → 审核版本
3. 点击"发布"
4. 确认发布

### 发布后

- 用户可以搜索小程序名称找到
- 可以生成小程序码推广
- 可以关联公众号

---

## 🔄 版本更新流程

### 后续更新步骤

1. **修改代码**
2. **重新构建**
   ```bash
   npm run build:mp-weixin
   ```
3. **上传新版本**（版本号递增，如1.0.1）
4. **提交审核**
5. **审核通过后发布**

---

## ⚠️ 注意事项

### 1. 域名配置
- ✅ 必须先在服务器上配置SSL证书
- ✅ 必须在微信后台配置合法域名
- ✅ 域名必须已备案

### 2. 功能测试
在提交审核前，必须测试：
- [ ] 用户注册登录
- [ ] 短信验证码
- [ ] 活动列表和详情
- [ ] 活动参与提交
- [ ] 图片上传
- [ ] 积分商城
- [ ] 商品兑换
- [ ] 个人中心
- [ ] 订单查询

### 3. 审核要点
- 提供真实有效的测试账号
- 功能描述清晰准确
- 类目和资质匹配
- 隐私政策完整

### 4. 常见拒审原因
- 服务器域名未配置或无法访问
- 功能与描述不符
- 缺少必要的隐私政策
- 类目选择不当
- 测试账号无法登录

---

## 📞 部署顺序

### 正确的部署顺序：

1. ✅ **服务器部署**（后端API）
2. ✅ **SSL证书配置**（HTTPS）
3. ⏳ **配置微信服务器域名**
4. ⏳ **更新小程序API地址**
5. ⏳ **构建并上传小程序**
6. ⏳ **提交审核**
7. ⏳ **审核通过后发布**

**当前进度：** 需要先完成服务器部署和SSL配置

---

## 📋 快速检查清单

### 服务器端（必须先完成）
- [ ] 后端API已部署
- [ ] SSL证书已配置
- [ ] HTTPS可以正常访问
- [ ] API接口测试通过

### 微信后台配置
- [ ] 服务器域名已配置
- [ ] 服务类目已设置
- [ ] 隐私政策已配置

### 小程序代码
- [ ] API地址已更新为生产环境
- [ ] AppID已配置
- [ ] 代码已构建
- [ ] 功能已测试

### 提交审核
- [ ] 代码已上传
- [ ] 版本信息已填写
- [ ] 测试账号已提供
- [ ] 审核已提交

---

## 🎯 下一步操作

**立即执行：**
1. 等待服务器部署完成
2. 配置SSL证书
3. 测试HTTPS访问

**服务器就绪后：**
1. 在微信后台配置服务器域名
2. 更新小程序API地址
3. 构建并上传小程序
4. 提交审核

**预计时间线：**
- 今晚：完成服务器部署和SSL配置
- 明天：配置小程序并提交审核
- 2-3天后：审核通过，正式上线

---

**所有配置信息已保存在 `平台配置信息/腾讯云服务器.ini` 中**
